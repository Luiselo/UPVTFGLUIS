const dims={height:500,width:1100},svg=d3.select(".canvas").append("svg").attr("width",dims.width+100).attr("height",dims.height+100),graph=svg.append("g").attr("transform","translate(0, 50)"),stratify=d3.stratify().id(t=>t.name).parentId(t=>t.parent),tree=d3.tree().size([dims.width,dims.height]),colour=d3.scaleOrdinal(["#f4511e","#e91e63","#e53935","#9c27b0"]),update=t=>{const a=dims.height/t.length;t.length;graph.selectAll(".node").remove(),graph.selectAll(".link").remove(),colour.domain(t.map(t=>t.id));const e=graph.selectAll(".node").data(t.map(t=>t.asignaturas));console.log("mirar");e.enter().append("g").attr("class","node").attr("transform",(t,e,r)=>`translate(0, ${e*a})`).each((function(t){console.log("1");const a=d3.scaleBand().domain(t.map(t=>t.asignatura)).range([0,dims.width]).paddingInner(.2).paddingOuter(.2),e=d3.scaleLinear().domain([0,t.length-1]).range([6,12]);console.log("2"),t.forEach(t=>{d3.select(this).append("g").attr("transform",(r,o,n)=>(console.log(e(o)),`translate(${a(t.asignatura)}, 100)`)).call(r=>r.append("text").attr("text-anchor","middle").attr("dy","-20").attr("x",a.bandwidth()/2).attr("fill",a=>colour(t.cursoID)).text(a=>t.asignatura).attr("font-size",(function(t,a){return e(a)}))).call(a=>a.append("circle").attr("fill",a=>colour(t.cursoID)).attr("stroke","#555").attr("stroke-width",2).attr("stroke-width",1.5).attr("r",4))})})).append("text").attr("text-anchor","middle").attr("dy",5).attr("fill","white")},proyectoParams=new URLSearchParams(window.location.search),proyecto=Object.fromEntries(proyectoParams.entries());async function obtenerGrafo(t){try{const a="http://localhost/UpTask_MVC/public/index.php/api/grafo?id="+t,e=await fetch(a),r=(await e.json()).respuesta.curso;return InicializarGrafo(r),r}catch(t){console.log(t)}}async function InicializarGrafo(t){var a=[];t.anoCurso.forEach(t=>{const e={...t,id:t.id};a.push(e)}),console.log(a),update(a)}obtenerGrafo(proyecto.id);