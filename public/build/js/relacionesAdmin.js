<<<<<<< HEAD
let idiomas=[],asignatura=[],asignaturas=[],idiomaSeleccionado="es",filtro="-1";console.log(curso),console.log(asi);const selectLanguage=document.getElementById("language-select");selectLanguage.addEventListener("change",(function(){const e=this.value;idiomaSeleccionado=e,filtrarAsignaturas(filtro)})),console.log("1");const cursosInputHidden=document.getElementById("contenido"),accordionButton=document.querySelector(".accordion-button"),accordionContent=document.querySelector(".accordion-content"),boton=document.getElementById("infoEditButton");function expandirCelda(e){e.nextElementSibling.style.display="block",e.style.display="none"}function contraerCelda(e){const t=e.parentElement;t.style.display="none",t.previousElementSibling.style.display="inline"}function editLabel(e){const t=document.getElementById(e+"Text"),n=document.getElementById(e+"Input"),a=document.getElementById(e+"Button");"none"===t.style.display?(t.style.display="inline",n.style.display="none",a.textContent="Editar"):(t.style.display="none",n.style.display="inline",a.textContent="Guardar")}function mostrarAlerta(e,t,n){console.log("1");const a=document.querySelector(".alerta");a&&a.remove(),console.log("2");const o=document.createElement("DIV");o.classList.add("alerta",t),o.textContent=e,console.log("3",n),n.parentElement.insertBefore(o,n.nextElementSibling),console.log("4"),setTimeout(()=>{o.remove()},5e3)}function expandTextArea(e){const t=document.getElementById(e+"TextareaContainer"),n=document.getElementById(e+"Arrow");"none"===t.style.display||""===t.style.display?(t.style.display="block",n.classList.add("arrow-up"),n.classList.remove("arrow-down")):(t.style.display="none",n.classList.add("arrow-down"),n.classList.remove("arrow-up"))}function panelInfo(e=!1,t={}){const n=document.createElement("div");n.classList.add("modalGrafo"),n.innerHTML=`\n      <form class="formulario nueva-tarea">\n      <div class ="relacion">\n      <dl>\n      \n      <dt>Centro:</dt>\n      <input type="text" class="relacionInput" id="centro" value="Facultad de Informática">\n      <dt>Titulación:</dt>\n      <input type="text" class="relacionInput" id="titulacion" value="Grado en Ingeniería Informática">\n      <dt>Curso Académico:</dt>\n      <input type="text" class="relacionInput" id="cursoAcademico" value="2023/24">\n      <dt>Curso:</dt>\n      <input type="text"  class="relacionInput" id="curso" value="Primero Obligatorio">\n      <dt>Nº Créditos:</dt>\n      <input type="text"  class="relacionInput" id="creditos" value="6">\n      <dt>Idiomas:</dt>\n      <input type="text"  class="relacionInput" id="idiomas" value="">\n      <ul class="listado-asignaturas" id="listado-temas">\n      </ul>\n\n  \n      </dl>\n      <div class="opciones">\n      <input \n          type="submit" \n          class="submit-nueva-tarea" \n          value="${t.nombre?"Guardar Cambios":"Añadir Asignatura"} " \n      />\n      <button type="button" class="cerrar-modal">Cancelar</button>\n  </div>    \n         \n      </form>\n      \n         `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),document.querySelector(".dashboard").appendChild(n),setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),console.log(n),n.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{n.remove()},500)}if(t.target.classList.contains("submit-nueva-tarea")){const t=document.getElementById("centro").value.trim(),n=document.getElementById("titulacion").value.trim(),a=document.getElementById("cursoAcademico").value.trim(),o=(document.getElementById("curso").value.trim(),document.getElementById("creditos").value.trim());if(""===t)return void mostrarAlerta("El Nombre del centro es Obligatorio","error",document.querySelector(".formulario legend"));if(""===n)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(""===descripcion)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(""===a)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(""===o)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(0==idiomas.length)return void mostrarAlerta("No puede contener ningun idioma","error",document.querySelector(".formulario legend"));e?(tarea.asignatura=nombreTarea,tarea.semestre=semestreTarea,tarea.descripcion=descripcion,actualizarTarea(tarea)):agregarTarea(nombreTarea,semestreTarea,descripcion)}}));document.getElementById("idiomas").addEventListener("keypress",guardarTag)}function actualizarInputHidden(){document.getElementById("formulario__listado").value=idiomas.toString()}async function actualizarTarea(e){document.querySelector("#tarea").value.trim(),document.getElementById("semestre").value.trim(),document.getElementById("descripcion").value.trim(),document.getElementById("descripcion").value.trim(),document.getElementById("descripcion").value.trim(),document.getElementById("descripcion").value.trim();try{const e="http://localhost/UpTask_MVC/public/index.php/api/asignatura/actualizar",t=await fetch(e,{method:"POST",body:datos}),n=await t.json();if(console.log(n),"exito"===n.tipo){Swal.fire(n.mensaje,n.mensaje,"success");const e=document.querySelector(".modal");e&&e.remove(),tareas=tareas.map(e=>(e.id===id&&(e.estado=estado,e.nombre=nombre),e)),mostrarTareas()}}catch(e){console.log(e)}}function guardarTag(e){if(44===e.keyCode){console.log("heloy , 1 ");const t=document.getElementById("idiomas");if(value=t.value,console.log("heloy , 2 "),e.preventDefault(),""===e.target.value.trim()||e.target.value<1)return;if(idiomas.find(e=>e==value))return;idiomas=[...idiomas,value],mostrarTags(),t.value=""}}function mostrarTags(){const e=document.getElementById("listado-temas"),t=document.getElementById("idiomas");e.innerHTML="",t.innerHTML="";idiomas.forEach(t=>{const n=document.createElement("LI");n.classList.add("curso_lista"),n.textContent=t,n.ondblclick=eliminarTag,e.appendChild(n)}),actualizarInputHidden()}function actualizarInputHidden(){document.getElementById("idiomas").value=idiomas.toString()}function eliminarTag(e){e.target.remove(),idiomas=idiomas.filter(t=>t!==e.target.textContent),actualizarInputHidden()}async function actualizarGuia(e,t){console.log("pasa",asi.id);const n=asi.id,a=new FormData;a.append("id",asi.id),a.append(e,t),a.append("nombre",e),console.log("pasa",a);try{const t="http://localhost/UpTask_MVC/public/index.php/api/asignatura/actualizarGuia",o=await fetch(t,{method:"POST",body:a});console.log("pasa",a);const i=await o.json();if(console.log(i),"exito"===i.tipo){Swal.fire(i.mensaje,i.mensaje,"success");const t=document.querySelector(".modal");t&&t.remove(),tareas=tareas.map(t=>(t.id===n&&(t.estado=estado,t.nombre=e),t)),mostrarTareas()}}catch(e){console.log(e)}}function obtenerAsignatura(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}boton.addEventListener("click",panelInfo),console.log(accordionButton),console.log("2"),accordionButton.addEventListener("click",(function(){"block"===accordionContent.style.display?accordionContent.style.display="none":accordionContent.style.display="block"})),console.log("3"),console.log("4"),document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("editarDescripcion"),t=document.getElementById("guiadocente");console.log("1"),e.addEventListener("click",(function(){console.log("pasa",t.value),actualizarGuia("descripcion",t.value)})),console.log("2");e=document.getElementById("editarCompetencias"),t=document.getElementById("competencias");e.addEventListener("click",(function(){console.log("pasa",t.value),actualizarGuia("competencia",t.value)})),console.log("3");e=document.getElementById("editarContenidos"),t=document.getElementById("contenidos");e.addEventListener("click",(function(){console.log("pasa",t.value),actualizarGuia("temario",t.value)})),console.log("4");e=document.getElementById("editarEvaluacion"),t=document.getElementById("sistema");e.addEventListener("click",(function(){console.log("pasa",t.value),actualizarGuia("evaluacion",t.value)})),console.log("5");e=document.getElementById("editarConvocatoria"),t=document.getElementById("convocatoria");e.addEventListener("click",(function(){console.log("pasa",t.value),actualizarGuia("convocatoria",t.value)}))}));var inputs=document.querySelectorAll('input[name="filtro"]');async function filtrarAsignaturas(e){const t=e;console.log("filtro chupi",e);const n=obtenerAsignatura(),a=new URLSearchParams(window.location.search);Object.fromEntries(a.entries()).id;const o=`http://localhost/UpTask_MVC/public/index.php/api/relacionAdmin?id=${t}&as=${n}`,i=await fetch(o),r=await i.json();asignaturas=r.resultado,visualizarAsignatuas(asignaturas,r.anos)}function visualizarAsignatuas(e,t){for(var n=document.querySelector(".relaciones-tabla");n.rows.length>0;)n.deleteRow(0);for(var a=n.insertRow(),o=["Asignatura Relacionada","Curso","Nivel de Relevancia","Inf"],i=0;i<o.length;i++){var r=document.createElement("th");r.textContent=o[i],a.appendChild(r)}for(i=0;i<e.length;i++){for(var l=n.insertRow(),c=[obtenerNombrePorIdioma(e[i]),"",e[i].asignatura,e[i].asignatura],s=e[i].id,d=0;d<t.length;d++)if(e[i].cursoID===t[d].id){c[1]=t[d].numero+" "+t[d].descripcion;break}for(d=0;d<c.length;d++){l.insertCell().textContent=c[d],l.setAttribute("data-asignatura-id",s)}1==e[i].tiene_relacion&&l.classList.add("verde")}var u=n.getElementsByTagName("tr");for(i=1;i<u.length;i++)u[i].addEventListener("click",(function(){this.classList.toggle("seleccionada");var e=this.getAttribute("data-asignatura-id");editarRelacion(obtenerAsignatura(),e)})),u[i].addEventListener("mouseover",(function(){this.classList.add("hovered")})),u[i].addEventListener("mouseout",(function(){this.classList.remove("hovered")}))}async function editarRelacion(e,t){const n=`http://localhost/UpTask_MVC/public/index.php/api/asignaturasRelacion?id1=${e}&id2=${t}`,a=await fetch(n),o=await a.json();asignatura1=o.respuesta.asignatura1,console.log("quiero ver",asignatura1),asignatura2=o.respuesta.asignatura2,nombre1=obtenerNombrePorIdioma(o.respuesta.asignatura1),nombre2=obtenerNombrePorIdioma(o.respuesta.asignatura2),info1=obtenerInfo(asignatura1),info2=obtenerInfo(asignatura2),console.log(asignatura1);const i=document.createElement("DIV");i.classList.add("modalGrafo"),i.innerHTML=`\n              <form class="formulario nueva-tarea"  style="overflow: auto;">\n  <div class="centrado">\n    <legend class="centered-text">Relación de Asignaturas</legend>\n    <h2 class="centered-text">${nombre1} y ${nombre2}</h2>\n\n    \n    \n    <div class="campo">\n      <label>Tipo de Relevancia:</label>\n      <select name="tipo_relevancia" id="tipoRelevancia">\n        <option value="fuerte">Relevancia Fuerte</option>\n        <option value="moderada">Relevancia Moderada</option>\n        <option value="ligera">Relevancia Ligera</option>\n      </select>\n    </div>\n\n    <div class="campo">\n      <label>Descripción de la Relación:</label>\n      <textarea name="descripcion_relacion" id="descripcionRelacion" rows="4"></textarea>\n    </div>\n<div class="campo" style="display: none;">\n      <label>Tags en común:</label>\n      <input type="text" id="tags" name="tags" disabled>\n    </div>\n\n\n\n    <div class="campo">\n      <ul class="listado-asignaturas" id="listado-temas"></ul>\n      <input type="hidden" class="formulario__listado" id="formulario__listado" name="lista_cursos" />\n    </div>\n\n    <div class="opciones">\n    <input \n        type="submit" \n        class="submit-nueva-tarea" \n        value="${asignatura.nombre?"Guardar Cambios":"Asignar Relación"} " \n    />\n    <button type="button" class="cerrar-modal">Cancelar</button>\n</div>    \n\n   \n  </div>\n</form>\n\n                 `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0);document.querySelector("table"),document.getElementById("contenido"),document.querySelector(".accordion-content1"),document.querySelector(".accordion-content2");console.log("1");document.createElement("tr"),document.createElement("td"),document.createElement("td"),document.createElement("td");document.createElement("td").innerHTML=`\n                               ${curso.nombre}\n                                  <button onclick="expandirCelda(this)">Ver Más</button>\n                                  <div style="display: none;">\n                                  Texto completo de la Relación\n                                  <button onclick="contraerCelda(this)">Cerrar</button>\n                                  </div>\n                                  `,i.addEventListener("click",(function(n){if(n.preventDefault(),n.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{i.remove()},150)}if(n.target.classList.contains("submit-nueva-tarea")){const n=document.getElementById("descripcionRelacion").value.trim(),a=document.getElementById("tipoRelevancia").value.trim();if(console.log("pasa"),""===n)return void mostrarAlerta("La descripción de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));agregarRelacion(n,a,e,t),setTimeout(()=>{i.remove()},150)}})),document.querySelector(".dashboard").appendChild(i)}async function agregarRelacion(e,t,n,a){const o=new FormData;o.append("descripcion",e),o.append("color",t),o.append("id_asignatura1",n),o.append("id_asignatura2",a);try{const e="http://localhost/UpTask_MVC/public/index.php/api/AnadirRelacion",t=await fetch(e,{method:"POST",body:o}),n=await t.json();if(mostrarAlerta(n.mensaje,n.tipo,document.querySelector(".formulario legend")),console.log(n.tipo),"exito"===n.tipo){const e=document.querySelector(".modal");e&&(e.remove(),window.location.reload())}}catch(e){console.log(e)}}function obtenerNombrePorIdioma(e){if(console.log(e,idiomaSeleccionado),e.info&&e.info.length>0){const t=e.info.find(e=>e.idioma===idiomaSeleccionado);if(t&&t.nombre)return t.nombre;const n=e.info[0];if(n&&n.nombre)return n.nombre}return e.asignatura}function obtenerInfo(e){if(console.log(e,idiomaSeleccionado),e.info&&e.info.length>0){const t=e.info.find(e=>e.idioma===idiomaSeleccionado);if(t&&t.nombre)return t;const n=e.info[0];if(n&&n.nombre)return n}return e.asignatura}inputs.forEach((function(e){e.addEventListener("change",(function(){filtro=this.value,filtrarAsignaturas(filtro)}))})),filtrarAsignaturas(filtro);
=======
let idiomas=[],asignatura=[],asignaturas=[],idiomaSeleccionado="es",filtro="-1",isFirstExecution=!0;const selectLanguage=document.getElementById("language-select");selectLanguage.addEventListener("change",(function(){const e=this.value;isFirstExecution=!1,idiomaSeleccionado=e,filtrarAsignaturas(filtro)}));const cursosInputHidden=document.getElementById("contenido"),accordionButton=document.querySelector(".accordion-button"),accordionContent=document.querySelector(".accordion-content");function expandirCelda(e){e.nextElementSibling.style.display="block",e.style.display="none"}function contraerCelda(e){const t=e.parentElement;t.style.display="none",t.previousElementSibling.style.display="inline"}function editLabel(e){const t=document.getElementById(e+"Text"),a=document.getElementById(e+"Input"),n=document.getElementById(e+"Button");"none"===t.style.display?(t.style.display="inline",a.style.display="none",n.textContent="Editar"):(t.style.display="none",a.style.display="inline",n.textContent="Guardar")}function mostrarAlerta(e,t,a){const n=document.querySelector(".alerta");n&&n.remove();const o=document.createElement("DIV");o.classList.add("alerta",t),o.textContent=e,a.parentElement.insertBefore(o,a.nextElementSibling),setTimeout(()=>{o.remove()},5e3)}function expandTextArea(e){const t=document.getElementById(e+"TextareaContainer"),a=document.getElementById(e+"Arrow");"none"===t.style.display||""===t.style.display?(t.style.display="block",a.classList.add("arrow-up"),a.classList.remove("arrow-down")):(t.style.display="none",a.classList.add("arrow-down"),a.classList.remove("arrow-up"))}function panelInfo(e=!1,t={}){const a=document.createElement("div");a.classList.add("modalGrafo"),a.innerHTML=`\n      <form class="formulario nueva-tarea">\n      <div class ="relacion">\n      <dl>\n      \n      <dt>Centro:</dt>\n      <input type="text" class="relacionInput" id="centro" value="Facultad de Informática">\n      <dt>Titulación:</dt>\n      <input type="text" class="relacionInput" id="titulacion" value="Grado en Ingeniería Informática">\n      <dt>Curso Académico:</dt>\n      <input type="text" class="relacionInput" id="cursoAcademico" value="2023/24">\n      <dt>Curso:</dt>\n      <input type="text"  class="relacionInput" id="curso" value="Primero Obligatorio">\n      <dt>Nº Créditos:</dt>\n      <input type="text"  class="relacionInput" id="creditos" value="6">\n      <dt>Idiomas:</dt>\n      <input type="text"  class="relacionInput" id="idiomas" value="">\n      <ul class="listado-asignaturas" id="listado-temas">\n      </ul>\n\n  \n      </dl>\n      <div class="opciones">\n      <input \n          type="submit" \n          class="submit-nueva-tarea" \n          value="${t.nombre?"Guardar Cambios":"Añadir Asignatura"} " \n      />\n      <button type="button" class="cerrar-modal">Cancelar</button>\n  </div>    \n         \n      </form>\n      \n         `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),document.querySelector(".dashboard").appendChild(a),setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),a.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{a.remove()},500)}if(t.target.classList.contains("submit-nueva-tarea")){const t=document.getElementById("centro").value.trim(),a=document.getElementById("titulacion").value.trim(),n=document.getElementById("cursoAcademico").value.trim(),o=(document.getElementById("curso").value.trim(),document.getElementById("creditos").value.trim());if(""===t)return void mostrarAlerta("El Nombre del centro es Obligatorio","error",document.querySelector(".formulario legend"));if(""===a)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(""===descripcion)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(""===n)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(""===o)return void mostrarAlerta("La titulacion de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));if(0==idiomas.length)return void mostrarAlerta("No puede contener ningun idioma","error",document.querySelector(".formulario legend"));e?(tarea.asignatura=nombreTarea,tarea.semestre=semestreTarea,tarea.descripcion=descripcion,actualizarTarea(tarea)):agregarTarea(nombreTarea,semestreTarea,descripcion)}}));document.getElementById("idiomas").addEventListener("keypress",guardarTag)}function actualizarInputHidden(){document.getElementById("formulario__listado").value=idiomas.toString()}async function actualizarTarea(e){document.querySelector("#tarea").value.trim(),document.getElementById("semestre").value.trim(),document.getElementById("descripcion").value.trim(),document.getElementById("descripcion").value.trim(),document.getElementById("descripcion").value.trim(),document.getElementById("descripcion").value.trim();try{const e="http://localhost/UpTask_MVC/public/index.php/api/asignatura/actualizar",t=await fetch(e,{method:"POST",body:datos}),a=await t.json();if("exito"===a.tipo){Swal.fire(a.mensaje,a.mensaje,"success");const e=document.querySelector(".modal");e&&e.remove(),tareas=tareas.map(e=>(e.id===id&&(e.estado=estado,e.nombre=nombre),e)),mostrarTareas()}}catch(e){console.log(e)}}function guardarTag(e){if(44===e.keyCode){const t=document.getElementById("idiomas");if(value=t.value,e.preventDefault(),""===e.target.value.trim()||e.target.value<1)return;if(idiomas.find(e=>e==value))return;idiomas=[...idiomas,value],mostrarTags(),t.value=""}}function mostrarTags(){const e=document.getElementById("listado-temas"),t=document.getElementById("idiomas");e.innerHTML="",t.innerHTML="";idiomas.forEach(t=>{const a=document.createElement("LI");a.classList.add("curso_lista"),a.textContent=t,a.ondblclick=eliminarTag,e.appendChild(a)}),actualizarInputHidden()}function actualizarInputHidden(){document.getElementById("idiomas").value=idiomas.toString()}function eliminarTag(e){e.target.remove(),idiomas=idiomas.filter(t=>t!==e.target.textContent),actualizarInputHidden()}async function actualizarGuia(e,t){const a=asi.id,n=new FormData;n.append("id",asi.id),n.append(e,t),n.append("nombre",e);try{const t="http://localhost/UpTask_MVC/public/index.php/api/asignatura/actualizarGuia",o=await fetch(t,{method:"POST",body:n}),i=await o.json();if("exito"===i.tipo){Swal.fire(i.mensaje,i.mensaje,"success");const t=document.querySelector(".modal");t&&t.remove(),tareas=tareas.map(t=>(t.id===a&&(t.estado=estado,t.nombre=e),t)),mostrarTareas()}}catch(e){console.log(e)}}function obtenerAsignatura(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}accordionButton.addEventListener("click",(function(){"block"===accordionContent.style.display?accordionContent.style.display="none":accordionContent.style.display="block"})),document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("editarDescripcion"),t=document.getElementById("guiadocente");e.addEventListener("click",(function(){actualizarGuia("descripcion",t.value)}));e=document.getElementById("editarCompetencias"),t=document.getElementById("competencias");e.addEventListener("click",(function(){actualizarGuia("competencia",t.value)}));e=document.getElementById("editarContenidos"),t=document.getElementById("contenidos");e.addEventListener("click",(function(){actualizarGuia("temario",t.value)}));e=document.getElementById("editarEvaluacion"),t=document.getElementById("sistema");e.addEventListener("click",(function(){actualizarGuia("evaluacion",t.value)}));e=document.getElementById("editarConvocatoria"),t=document.getElementById("convocatoria");e.addEventListener("click",(function(){actualizarGuia("convocatoria",t.value)}))}));var inputs=document.querySelectorAll('input[name="filtro"]');async function filtrarAsignaturas(e){const t=e,a=obtenerAsignatura(),n=new URLSearchParams(window.location.search);Object.fromEntries(n.entries()).id;const o=`http://localhost/UpTask_MVC/public/index.php/api/relacionAdmin?id=${t}&as=${a}`,i=await fetch(o),r=await i.json();asignaturas=r.resultado,asignaturaActual=r.actualasignatura,curso=r.curso,visualizarAsignatuas(asignaturas,r.anos,asignaturaActual,curso)}function visualizarAsignatuas(e,t,a,n){isFirstExecution&&(titulo=document.getElementById("titulo").textContent,document.getElementById("titulo").textContent=titulo+" "+obtenerNombrePorIdioma(a),isFirstExecution=!1);for(var o=document.querySelector(".relaciones-tabla");o.rows.length>0;)o.deleteRow(0);for(var i=o.insertRow(),r=["Asignatura Relacionada","Curso","Nivel de Relevancia","Inf","Eliminar"],c=0;c<r.length;c++){var l=document.createElement("th");l.textContent=r[c],i.appendChild(l)}for(c=0;c<e.length;c++)if(e[c].id!=a.id){var s=o.insertRow(),d="";if(e[c].relaciones&&e[c].relaciones.length>0)switch(parseInt(e[c].relaciones[0].color,10)){case 2:d="Relevancia Fuerte";break;case 1:d="Relevancia Moderada";break;case 0:d="Relevancia Ligera"}for(var u=[obtenerNombrePorIdioma(e[c]),"",d,e[c].url],m=e[c].id,p=0;p<t.length;p++)if(e[c].cursoID===t[p].id){u[1]=t[p].numero+" "+t[p].descripcion;break}for(p=0;p<u.length;p++){s.insertCell().textContent=u[p],s.setAttribute("data-asignatura-id",m)}if(1==e[c].tiene_relacion){s.classList.add("verde");var g=s.insertCell(),f=document.createElement("button");f.textContent="Eliminar",function(e){f.onclick=function(){event.stopPropagation(),eliminarRelacionMensaje(e.relaciones[0])}}(e[c]),g.appendChild(f)}}var v=o.getElementsByTagName("tr");for(c=1;c<v.length;c++){var y=v[c].cells[1].textContent;numero=y.match(/\d+/)[0],numero>=n.numero&&v[c].addEventListener("click",(function(){this.classList.toggle("seleccionada");var e=this.getAttribute("data-asignatura-id");editarRelacion(obtenerAsignatura(),e)})),v[c].addEventListener("mouseover",(function(){this.classList.add("hovered")})),v[c].addEventListener("mouseout",(function(){this.classList.remove("hovered")}))}}function eliminarRelacionMensaje(e){console.log(),console.log("heyy"),console.log(e),Swal.fire({title:"¿Estás seguro de que deseas eliminar la relación? ",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&(console.log("Confirmación de eliminación recibida"),eliminarRelacion(e))})}async function eliminarRelacion(e){console.log("Iniciando eliminación del curso con ID:"),console.log(e.id);const t=new FormData;t.append("id",e.id),console.log("datos",t);try{const e="http://localhost/UpTask_MVC/public/index.php/api/eliminarRelacion",a=await fetch(e,{method:"POST",body:t});if(!a.ok)throw new Error("Error en la solicitud: "+a.statusText);const n=await a.json();if(console.log(n),"Exito"!==n.tipo)throw new Error("Error en el servidor: "+n.mensaje);console.log("pasaaaaaaa"),console.log("Relación eliminada correctamente"),Swal.fire({title:"Éxito",text:"La relación ha sido eliminada correctamente",icon:"success",confirmButtonText:"OK"}).then(e=>{e.isConfirmed&&location.reload()})}catch(e){console.error(e),Swal.fire("Error","Hubo un problema al eliminar la relación: "+e.message,"error")}}async function editarRelacion(e,t){const a=`http://localhost/UpTask_MVC/public/index.php/api/asignaturasRelacion?id1=${e}&id2=${t}`,n=await fetch(a),o=await n.json();var i="",r="",c="";o.respuesta.relacion&&o.respuesta.relacion.length>0&&(i=o.respuesta.relacion[0].color,c=o.respuesta.relacion[0].id,r=o.respuesta.relacion[0].descripcion),asignatura1=o.respuesta.asignatura1,asignatura2=o.respuesta.asignatura2,nombre1=obtenerNombrePorIdioma(o.respuesta.asignatura1),nombre2=obtenerNombrePorIdioma(o.respuesta.asignatura2),info1=obtenerInfo(asignatura1),info2=obtenerInfo(asignatura2);var l=document.createElement("div");l.classList.add("modalGrafo"),l.innerHTML=`\n                <form class="formulario nueva-tarea" style="overflow: auto;">\n                    <div class="centrado">\n                        <legend class="centered-text">Relación de Asignaturas</legend>\n                        <h2 class="centered-text">${nombre1} y ${nombre2}</h2>\n                        <div class="campo">\n                            <label>Tipo de Relevancia:</label>\n                            <select name="tipo_relevancia" id="tipoRelevancia">\n                                <option value="2">Relevancia Fuerte</option>\n                                <option value="1">Relevancia Moderada</option>\n                                <option value="0">Relevancia Ligera</option>\n                            </select>\n                        </div>\n                        <div class="campo">\n                            <label>Descripción de la Relación:</label>\n                            <textarea name="descripcion_relacion" id="descripcionRelacion" rows="4"></textarea>\n                        </div>\n                        <div class="campo" style="display: none;">\n                            <label>Tags en común:</label>\n                            <input type="text" id="tags" name="tags" disabled>\n                        </div>\n                        <div class="campo">\n                            <ul class="listado-asignaturas" id="listado-temas"></ul>\n                            <input type="hidden" class="formulario__listado" id="formulario__listado" name="lista_cursos" />\n                        </div>\n                        <div class="opciones">\n                            <input type="submit" class="submit-nueva-tarea" value="Guardar Cambios" />\n                            <button type="button" class="cerrar-modal">Cancelar</button>\n                        </div>\n                    </div>\n                </form>\n            `,document.body.appendChild(l),document.getElementById("tipoRelevancia").value=i,document.getElementById("descripcionRelacion").value=r,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0);document.querySelector("table"),document.getElementById("contenido"),document.querySelector(".accordion-content1"),document.querySelector(".accordion-content2"),document.createElement("tr"),document.createElement("td"),document.createElement("td"),document.createElement("td");document.createElement("td").innerHTML=`\n                               ${curso.nombre}\n                                  <button onclick="expandirCelda(this)">Ver Más</button>\n                                  <div style="display: none;">\n                                  Texto completo de la Relación\n                                  <button onclick="contraerCelda(this)">Cerrar</button>\n                                  </div>\n                                  `,l.addEventListener("click",(function(a){if(a.preventDefault(),a.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{l.remove()},150)}if(a.target.classList.contains("submit-nueva-tarea")){const a=document.getElementById("descripcionRelacion").value.trim(),n=document.getElementById("tipoRelevancia").value.trim();if(""===a)return void mostrarAlerta("La descripción de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));agregarRelacion(a,n,e,t,c),setTimeout(()=>{l.remove()},150)}})),document.querySelector(".dashboard").appendChild(l)}async function agregarRelacion(e,t,a,n,o){const i=new FormData;""!=o&&i.append("id",o),i.append("descripcion",e),i.append("color",t),i.append("id_asignatura1",a),i.append("id_asignatura2",n),console.log("PRUEBAAAAAAAAAA");try{const e="http://localhost/UpTask_MVC/public/index.php/api/AnadirRelacion",t=await fetch(e,{method:"POST",body:i}),a=await t.json();if(location.reload(),mostrarAlerta(a.mensaje,a.tipo,document.querySelector(".formulario legend")),"exito"===a.tipo){const e=document.querySelector(".modal");e&&(window.location.reload(),e.remove())}}catch(e){console.log(e)}}function obtenerNombrePorIdioma(e){if(e.info&&e.info.length>0){const t=e.info.find(e=>e.idioma===idiomaSeleccionado);if(t&&t.nombre)return t.nombre;const a=e.info[0];if(a&&a.nombre)return a.nombre}return e.asignatura}function obtenerInfo(e){if(e.info&&e.info.length>0){const t=e.info.find(e=>e.idioma===idiomaSeleccionado);if(t&&t.nombre)return t;const a=e.info[0];if(a&&a.nombre)return a}return e.asignatura}inputs.forEach((function(e){e.addEventListener("change",(function(){filtro=this.value,filtrarAsignaturas(filtro)}))})),filtrarAsignaturas(filtro);
>>>>>>> 25b85b50 (Inicial commit del proyecto UpTask_MVC)
